{% extends "base.html" %}

{% block title %}Registrar movimiento{% endblock %}

{% block content %}
  <h1 class="h3 fw-bold mb-3">Movimiento de stock</h1>

  <section class="bg-white rounded-4 shadow-sm p-4" x-data="{ tipo: '' }">
    <!-- Botones de tipo de movimiento (como opciones del dashboard) -->
    <div class="btn-group mb-4" role="group" aria-label="Tipo de movimiento">
      <button type="button"
              class="btn btn-sm"
              :class="tipo === 'INGRESO' ? 'btn-dark' : 'btn-outline-secondary'"
              @click="tipo = 'INGRESO'">
        Nuevo ingreso
      </button>
      <button type="button"
              class="btn btn-sm"
              :class="tipo === 'EGRESO' ? 'btn-dark' : 'btn-outline-secondary'"
              @click="tipo = 'EGRESO'">
        Nuevo egreso
      </button>
      <button type="button"
              class="btn btn-sm"
              :class="tipo === 'AJUSTE' ? 'btn-dark' : 'btn-outline-secondary'"
              @click="tipo = 'AJUSTE'">
        Ajuste de stock
      </button>
    </div>

    <form method="post" class="row g-3">
      {% csrf_token %}

      <!-- Campo real que se envía al backend -->
      <input type="hidden" name="tipo" :value="tipo">

      <div class="col-md-4">
        <label class="form-label">Tipo de movimiento</label>
        <div class="form-control bg-light">
          <span x-show="tipo === ''" class="text-muted">Seleccionar arriba</span>
          <span x-show="tipo === 'INGRESO'">Ingreso</span>
          <span x-show="tipo === 'EGRESO'">Egreso</span>
          <span x-show="tipo === 'AJUSTE'">Ajuste</span>
        </div>

        <div class="form-text mt-1" x-show="tipo === 'INGRESO'">
          Ingreso: suma unidades al stock actual del artículo.
        </div>
        <div class="form-text mt-1 text-danger" x-show="tipo === 'EGRESO'">
          Egreso: descuenta unidades del stock. El sistema no permite dejar stock negativo.
        </div>
        <div class="form-text mt-1 text-primary" x-show="tipo === 'AJUSTE'">
          Ajuste: corrige diferencias de inventario. Podés usar cantidades positivas o negativas.
        </div>
      </div>

      <div class="col-md-4">
        <label for="valor_qr" class="form-label">Código QR leído</label>
        <input type="text" id="valor_qr" name="valor_qr" class="form-control" required
               placeholder="Valor que devuelve el lector de QR">
      </div>

      <div class="col-md-4">
        <label for="proveedor" class="form-label">Proveedor (opcional)</label>
        <select id="proveedor" name="proveedor_id" class="form-select">
          <option value="">Seleccionar proveedor...</option>
          {% if proveedores %}
            {% for prov in proveedores %}
              <option value="{{ prov.id }}">{{ prov.razon_social }}</option>
            {% endfor %}
          {% else %}
            <option value="" disabled>No hay proveedores</option>
          {% endif %}
        </select>
      </div>

      <div class="col-md-4">
        <label for="cantidad" class="form-label">Cantidad</label>
        <input type="number" step="1" id="cantidad" name="cantidad" class="form-control" required
               placeholder="Para AJUSTE podés usar valores negativos">
      </div>

      <div class="col-12">
        <label for="observaciones" class="form-label">Observaciones</label>
        <input type="text" id="observaciones" name="observaciones" class="form-control">
      </div>

      <div class="col-12 d-flex justify-content-end pt-3 border-top mt-2">
        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary me-2">
          Cancelar
        </a>
        <button type="submit" class="btn btn-dark" :disabled="tipo === ''">
          Registrar movimiento
        </button>
      </div>
    </form>
  </section>
{% endblock %}

